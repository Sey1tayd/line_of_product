<!DOCTYPE html>
<html lang="tr" class="h-full bg-slate-950 text-slate-100">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kullanıcı Oturumları</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
  <header class="border-b border-slate-800 bg-slate-900/60 backdrop-blur px-4 py-3 flex items-center justify-between">
    <a href="/" class="text-[12px] text-slate-400 hover:text-indigo-300">← Geri</a>
    <div class="text-lg font-semibold">Kullanıcı Oturumları</div>
    <div class="text-right text-sm leading-tight" id="userBox"></div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6 space-y-6">
    <section class="bg-slate-900/60 ring-1 ring-slate-800 rounded-2xl p-4">
      <div class="flex items-center justify-between mb-3">
        <div>
          <div class="text-[11px] uppercase tracking-widest text-slate-500 font-medium">İşlem Logları</div>
          <div class="text-base font-semibold">Son İşlemler</div>
        </div>
        <div class="flex gap-2 text-[12px]">
          <button id="refreshBtn" class="rounded-lg bg-slate-800/70 ring-1 ring-slate-700 px-3 py-2 hover:ring-indigo-500/40 hover:text-indigo-300 transition">Yenile</button>
        </div>
      </div>
      <div id="logList" class="text-[12px] text-slate-300 space-y-1"></div>
    </section>
  </main>

  <script>
    async function fetchJSON(url) { const r = await fetch(url); if (!r.ok) throw new Error('HTTP '+r.status); return await r.json(); }
    async function loadUser() {
      try {
        const u = await fetchJSON('/api/whoami/');
        if (!u.is_authenticated) { window.location.href = '/login/'; return; }
        if (!u.is_admin) { window.location.href = '/'; return; }
        document.getElementById('userBox').innerHTML = `<div class="text-slate-200 font-medium">Kullanıcı: <span class="text-indigo-400">${u.username}</span></div>`;
      } catch {}
    }
    async function loadLogs() {
      try {
        const logs = await fetchJSON('/api/admin/activity-logs/');
        const list = document.getElementById('logList');
        list.innerHTML = logs.map(l => {
          const when = new Date(l.created_at).toLocaleString('tr-TR', {day:'2-digit', month:'2-digit', year:'2-digit', hour:'2-digit', minute:'2-digit'});
          const who = l.user_username || '—';
          const mach = l.machine_short_name || '—';
          const det = l.details || '';
          return `<div class="flex justify-between"><span>${when} • ${who} • ${l.action} @ ${mach}</span><span class="text-slate-400">${det}</span></div>`;
        }).join('');
      } catch (e) {
        document.getElementById('logList').innerHTML = '<div class="text-slate-400">Kayıt alınamadı.</div>';
      }
    }
    document.getElementById('refreshBtn').addEventListener('click', loadLogs);
    loadUser();
    loadLogs();
  </script>
</body>
</html>


